# Chat App - ãƒ¡ãƒ¼ãƒ«èªè¨¼ä»˜ããƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ä»®ç™»éŒ²å¾Œã€Resendã§ãƒ¡ãƒ¼ãƒ«èªè¨¼ã‚’è¡Œã„ã€æœ¬ç™»éŒ²ãŒå®Œäº†ã—ãŸå¾Œã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆã«å‚åŠ ã§ãã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- âœ… ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- âœ… Resend APIã«ã‚ˆã‚‹ãƒ¡ãƒ¼ãƒ«èªè¨¼
- âœ… Lucia Authã«ã‚ˆã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- âœ… ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿ãƒ»é–²è¦§æ©Ÿèƒ½ï¼ˆ3ç§’ã”ã¨ã«ãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰
- âœ… Cloudflare D1ã«ã‚ˆã‚‹æ°¸ç¶šåŒ–
- âœ… ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆSHA-256 + Saltï¼‰

## ğŸŒ URLs

- **æœ¬ç•ªç’°å¢ƒ**: https://babd9aa5.chatserver.pages.dev
- **é–‹ç™ºç’°å¢ƒ**: https://3000-ilw8e35d9sf74wv8mzurp-cc2fbc16.sandbox.novita.ai
- **GitHub**: https://github.com/garyohosu/chatServer

## ğŸ—ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Hono v4
- **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ **: Cloudflare Workers / Pages
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Cloudflare D1 (SQLite)
- **èªè¨¼**: Lucia Auth v3
- **ãƒ¡ãƒ¼ãƒ«é€ä¿¡**: Resend API
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: TailwindCSS (CDN)
- **é–‹ç™ºãƒ„ãƒ¼ãƒ«**: Wrangler, Vite, PM2

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 

### users ãƒ†ãƒ¼ãƒ–ãƒ«
- `id` (TEXT): ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `email` (TEXT): ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰
- `password_hash` (TEXT): ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥
- `verified` (INTEGER): ãƒ¡ãƒ¼ãƒ«èªè¨¼æ¸ˆã¿ãƒ•ãƒ©ã‚°ï¼ˆ0/1ï¼‰
- `created_at` (INTEGER): ä½œæˆæ—¥æ™‚ï¼ˆãƒŸãƒªç§’ï¼‰

### email_verification_tokens ãƒ†ãƒ¼ãƒ–ãƒ«
- `token` (TEXT): èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³
- `user_id` (TEXT): ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `expires_at` (INTEGER): æœ‰åŠ¹æœŸé™ï¼ˆãƒŸãƒªç§’ï¼‰

### sessions ãƒ†ãƒ¼ãƒ–ãƒ«
- `id` (TEXT): ã‚»ãƒƒã‚·ãƒ§ãƒ³ID
- `user_id` (TEXT): ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `expires_at` (INTEGER): æœ‰åŠ¹æœŸé™

### messages ãƒ†ãƒ¼ãƒ–ãƒ«
- `id` (INTEGER): ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸IDï¼ˆè‡ªå‹•æ¡ç•ªï¼‰
- `user_id` (TEXT): æŠ•ç¨¿è€…ID
- `message` (TEXT): ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹
- `created_at` (INTEGER): æŠ•ç¨¿æ—¥æ™‚ï¼ˆãƒŸãƒªç§’ï¼‰

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.dev.vars` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã‚’è¨­å®šï¼š

```bash
# Resend API Key (https://resend.com/api-keys ã‹ã‚‰å–å¾—)
RESEND_API_KEY=re_xxxxx

# Base URL for email verification links
BASE_URL=http://localhost:3000
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨
npm run db:migrate:local

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
npm run db:seed
```

### 4. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
# ãƒ“ãƒ«ãƒ‰
npm run build

# PM2ã§èµ·å‹•
pm2 start ecosystem.config.cjs

# ãƒ­ã‚°ç¢ºèª
pm2 logs webapp --nostream
```

### 5. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã‚¢ã‚¯ã‚»ã‚¹

é–‹ç™ºç’°å¢ƒ: http://localhost:3000

## ğŸ“± ä½¿ã„æ–¹

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼

1. `/register` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ8æ–‡å­—ä»¥ä¸Šï¼‰ã‚’å…¥åŠ›
3. ã€Œç™»éŒ²ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ç™»éŒ²ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«èªè¨¼ãƒ¡ãƒ¼ãƒ«ãŒå±Šã
5. ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
6. è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã€`/chat` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

### ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

1. `/login` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
3. ã€Œãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. `/chat` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

### ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›æ¬„ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã€ã€Œé€ä¿¡ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯3ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°
- è‡ªåˆ†ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯é’è‰²ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç°è‰²ã§è¡¨ç¤º

## ğŸ”§ npm ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# é–‹ç™º
npm run dev                 # Viteé–‹ç™ºã‚µãƒ¼ãƒãƒ¼
npm run dev:sandbox         # Wranglerãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ï¼ˆPM2æ¨å¥¨ï¼‰
npm run build               # ãƒ“ãƒ«ãƒ‰

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
npm run db:migrate:local    # ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npm run db:migrate:prod     # æœ¬ç•ªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npm run db:seed             # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥
npm run db:reset            # ãƒ­ãƒ¼ã‚«ãƒ«DBãƒªã‚»ãƒƒãƒˆ
npm run db:console:local    # ãƒ­ãƒ¼ã‚«ãƒ«DBã‚³ãƒ³ã‚½ãƒ¼ãƒ«
npm run db:console:prod     # æœ¬ç•ªDBã‚³ãƒ³ã‚½ãƒ¼ãƒ«

# ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy              # Cloudflare Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤

# ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
npm run cf-typegen          # CloudflareBindingså‹ç”Ÿæˆ
npm run clean-port          # ãƒãƒ¼ãƒˆ3000ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```

## ğŸ“¡ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### èªè¨¼ç³»

- `POST /api/register` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- `GET /verify?token=xxx` - ãƒ¡ãƒ¼ãƒ«èªè¨¼
- `POST /api/login` - ãƒ­ã‚°ã‚¤ãƒ³
- `POST /api/logout` - ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- `GET /api/user` - ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—

### ãƒãƒ£ãƒƒãƒˆç³»

- `POST /api/messages` - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿
- `GET /api/messages?after=<timestamp>` - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—

### ãƒšãƒ¼ã‚¸

- `GET /` - ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸
- `GET /register` - ç™»éŒ²ãƒšãƒ¼ã‚¸
- `GET /login` - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
- `GET /chat` - ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ SHA-256 + ãƒ©ãƒ³ãƒ€ãƒ ã‚½ãƒ«ãƒˆã§ãƒãƒƒã‚·ãƒ¥åŒ–
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¯ Lucia Auth ã‚’ä½¿ç”¨
- ãƒ¡ãƒ¼ãƒ«èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã¯60åˆ†ã§æœ‰åŠ¹æœŸé™åˆ‡ã‚Œ
- HTTPSæ¥ç¶šå¿…é ˆï¼ˆCloudflare Pagesï¼‰
- CORSè¨­å®šæ¸ˆã¿ï¼ˆAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã¿ï¼‰

## ğŸš€ æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### 1. Cloudflare API Keyã®è¨­å®š

```bash
# Cloudflare API Keyã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
# ï¼ˆãƒ„ãƒ¼ãƒ«ãŒè‡ªå‹•çš„ã«ã‚¬ã‚¤ãƒ‰ï¼‰
```

### 2. æœ¬ç•ªD1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ

```bash
npx wrangler d1 create webapp-production
```

ä½œæˆã•ã‚ŒãŸdatabase_idã‚’`wrangler.toml`ã«è¨­å®šï¼š

```toml
[[d1_databases]]
binding = "DB"
database_name = "webapp-production"
database_id = "your-database-id-here"
```

### 3. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®é©ç”¨

```bash
npm run db:migrate:prod
```

### 4. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
# Resend API Key
npx wrangler pages secret put RESEND_API_KEY

# Base URLï¼ˆæœ¬ç•ªURLï¼‰
npx wrangler pages secret put BASE_URL
```

### 5. ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
npm run deploy
```

## ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
webapp/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.tsx           # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ auth.ts         # Lucia Authè¨­å®š
â”‚       â”œâ”€â”€ utils.ts        # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
â”‚       â””â”€â”€ resend.ts       # Resend APIçµ±åˆ
â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ 0001_initial_schema.sql  # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ public/                 # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ dist/                   # ãƒ“ãƒ«ãƒ‰å‡ºåŠ›
â”œâ”€â”€ .dev.vars               # é–‹ç™ºç’°å¢ƒå¤‰æ•°
â”œâ”€â”€ wrangler.toml           # Cloudflareè¨­å®š
â”œâ”€â”€ ecosystem.config.cjs    # PM2è¨­å®š
â”œâ”€â”€ package.json            # ä¾å­˜é–¢ä¿‚
â””â”€â”€ README.md               # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒ¼ãƒˆ3000ãŒä½¿ç”¨ä¸­

```bash
npm run clean-port
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œãªã„

```bash
npm run db:reset
```

### ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œãªã„

1. `.dev.vars` ã«æ­£ã—ã„RESEND_API_KEYãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. Resendã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ‰ãƒ¡ã‚¤ãƒ³èªè¨¼ã‚’ç¢ºèª
3. é–‹ç™ºç’°å¢ƒã§ã¯ `noreply@yourdomain.com` ã‚’èªè¨¼æ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å¤‰æ›´

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

ãƒ–ãƒ©ã‚¦ã‚¶ã®Cookieã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰å†åº¦ãƒ­ã‚°ã‚¤ãƒ³

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT

## ğŸ‘¤ ä½œè€…

hantani - AIæ™‚ä»£ã®å‰µä½œç ”ç©¶è€…ãƒ»æŠ€è¡“ç³»ãƒ©ã‚¤ã‚¿ãƒ¼

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯

- [Hono Documentation](https://hono.dev/)
- [Cloudflare D1 Documentation](https://developers.cloudflare.com/d1/)
- [Lucia Auth Documentation](https://lucia-auth.com/)
- [Resend Documentation](https://resend.com/docs)

---

**æœ€çµ‚æ›´æ–°**: 2025-11-20
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ãƒ»ç¨¼åƒä¸­
**æœ¬ç•ªURL**: https://babd9aa5.chatserver.pages.dev
